import{r as a,q as e,s as l,c as o,w as s,i as u,o as t,a as n,g as d,u as c,v as i,n as r,x as m,I as f,m as p,h as v}from"./index-CAf17vbk.js";import{_}from"./uni-icons.G0vPWgS5.js";import{r as g}from"./uni-app.es.BzRW0A8E.js";import{m as k,n as y,o as w,p as x}from"./index.DsHGnwb0.js";import{_ as h}from"./_plugin-vue_export-helper.BCo6x5W8.js";const I=h({__name:"login",setup(h){const I=a(0),V=a(""),j=a(""),C=a(""),$=async()=>{if(""===V.value||""===j.value)return;if(!/^\w+@163\.com$/.test(V.value))return console.log("邮箱错误"),void(V.value=j.value="");const a=`email=${V.value}&password=${j.value}`,e=await k(a);console.log(e),i("logined",e.data.cookie),r({url:"/pages/index/index"})};let q=null;const z=async()=>{I.value=2,clearInterval(q);const a=await y(),e=await w(a.data.data.unikey);C.value=e.data.data.qrimg,q=setInterval((async()=>{let e=await x(a.data.data.unikey);console.log(e.data.message),802===e.data.code&&(console.log(e.data.message),console.log(e),console.log(e.data)),803===e.data.code&&(console.log("login success !"),console.log(e),console.log(e.data),clearInterval(q),i("logined",e.data.cookie),m({url:"/pages/mine/mine"}))}),1e3)};return e((()=>I.value),(()=>{clearInterval(q)})),(a,e)=>{const i=f,r=u,m=p,k=g(l("uni-icons"),_),y=v;return t(),o(r,null,{default:s((()=>[0===I.value?(t(),o(r,{key:0,class:"uni-form-code"},{default:s((()=>[n(r,null,{default:s((()=>[n(i,{focus:"",placeholder:"请输入手机号"})])),_:1}),n(r,null,{default:s((()=>[n(i,{placeholder:"请输入验证码"}),n(m,null,{default:s((()=>[d("获取验证码")])),_:1})])),_:1})])),_:1})):c("",!0),1===I.value?(t(),o(r,{key:1,class:"uni-form-email"},{default:s((()=>[n(r,null,{default:s((()=>[n(k,{type:"email",size:"30"}),n(i,{focus:"",placeholder:"请输入邮箱",modelValue:V.value,"onUpdate:modelValue":e[0]||(e[0]=a=>V.value=a),modelModifiers:{trim:!0}},null,8,["modelValue"])])),_:1}),n(r,null,{default:s((()=>[n(k,{type:"locked",size:"30"}),n(i,{password:"",type:"text",placeholder:"请输入密码",modelValue:j.value,"onUpdate:modelValue":e[1]||(e[1]=a=>j.value=a),modelModifiers:{trim:!0}},null,8,["modelValue"])])),_:1}),n(m,{onClick:$},{default:s((()=>[d("提交")])),_:1})])),_:1})):c("",!0),2===I.value?(t(),o(r,{key:2,class:"uni-form-QRcode"},{default:s((()=>[n(y,{src:C.value,mode:""},null,8,["src"])])),_:1})):c("",!0),n(r,{class:"login-type"},{default:s((()=>[n(r,{onClick:e[2]||(e[2]=a=>I.value=0)},{default:s((()=>[d("手机号登录")])),_:1}),n(r,{onClick:e[3]||(e[3]=a=>I.value=1)},{default:s((()=>[d("邮箱登录")])),_:1}),n(r,{onClick:z},{default:s((()=>[d("二维码登录")])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-8c4e2724"]]);export{I as default};
